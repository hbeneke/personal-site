---
import BaseLayout from "@layouts/base-layout.astro";
import CVDownload from "@components/cv-download.astro";
import { calculateDuration } from "@utils/date";
import { getAllWorkExperiences, getWorkExperienceYears } from "@utils/resume";
import { getAllSkills } from "@utils/skills";
import { getAllHonorsGroupByCategory } from "@utils/honor";
import { siteConfig } from "@site-config";

const work_experience = await getAllWorkExperiences();
const years = await getWorkExperienceYears();
const skills = await getAllSkills();
const honors = await getAllHonorsGroupByCategory(true);
---

<BaseLayout
  title={`Resume · ${siteConfig.siteTitle}`}
  description={`${siteConfig.authorName} resume, a Senior ${siteConfig.jobTitle} specializing in Javascript and modern web technologies.`}
>
  <div class="max-w-4xl mx-auto text-xs leading-relaxed">
    <header class="text-center mb-12">
      <div class="mb-6">
        <span class="text-[32pt] mr-1 font-light text-gray-300 leading-none"
          >Enrique</span
        >
        <span class="text-[32pt] font-bold leading-none">Quero</span>
      </div>
      <div
        class="text-[8pt] tracking-widest uppercase font-semibold secondary mb-1"
      >
        Senior {siteConfig.jobTitle} / Tech lead
      </div>
      <div class="text-[9pt] italic text-gray-300 mb-6">
        "Never Stop Learning."
      </div>
      <div class="flex justify-center">
        <CVDownload />
      </div>
    </header>

    <!-- Summary Section -->
    <section class="mb-12">
      <h2
        class="text-[16pt] font-bold mb-2 flex items-center text-gray-200 section-title-line"
      >
        <span class="secondary">Sum</span>mary
      </h2>
      <div
        class="text-[9pt] mt-3 leading-relaxed text-justify font-light text-gray-300"
      >
        Web developer with {calculateDuration(years.start, years.end)} of experience
        in web development, always looking for new challenges and projects that feed
        my motto of "Never Stop Learning."
      </div>
    </section>

    <section class="mb-12">
      <h2
        class="text-[16pt] font-bold mb-2 flex items-center text-gray-200 section-title-line"
      >
        <span class="secondary">Wor</span>k Experience
      </h2>
      <div class="mt-3">
        {
          work_experience.map((experience) => (
            <div class="mb-8">
              <div class="grid grid-cols-1 lg:grid-cols-4 gap-4 mb-1">
                <div class="lg:col-span-3">
                  <div class="text-[12pt] font-bold mb-1 text-yellow-400 hover:text-yellow-200 cursor-pointer">
                    @{experience.company}
                  </div>
                  <div class="text-[8pt] font-semibold uppercase text-gray-300">
                    {experience.position}
                  </div>
                </div>
                <div class="lg:text-right">
                  <div class="text-[11px] italic font-light secondary mb-1 whitespace-nowrap overflow-hidden text-ellipsis">
                    {experience.location}
                  </div>
                  <div class="text-[8pt] italic font-light text-gray-400 whitespace-nowrap">
                    {`${experience.start_date} – ${experience.end_date}`}
                  </div>
                </div>
              </div>
              {experience.description && (
                <p class="text-[9pt] text-gray-300 mb-4 italic">
                  {experience.description}
                </p>
              )}
              {experience.responsibilities &&
                experience.responsibilities.length > 0 && (
                  <ul class="list-none pl-1 mt-2">
                    {experience.responsibilities.map((responsibility) => (
                      <li class="text-[9pt] font-light tracking-tight text-gray-300 bullet-point-dark relative pl-3 mb-1">
                        {responsibility}
                      </li>
                    ))}
                  </ul>
                )}
            </div>
          ))
        }
      </div>
    </section>

    <!-- Skills Section -->
    <section class="mb-12">
      <h2
        class="text-[16pt] font-bold mb-2 flex items-center text-gray-200 section-title-line"
      >
        <span class="secondary">Ski</span>lls
      </h2>
      <div class="mt-3 space-y-1">
        {
          skills.map((skill) => (
            <div class="grid grid-cols-1 md:grid-cols-5 gap-4 items-start">
              <div class="md:text-right">
                <div class="text-[12px] font-bold text-gray-200">
                  {skill.name}
                </div>
              </div>
              <div class="md:col-span-4">
                <div class="text-[12px] tracking-tight font-light text-gray-300">
                  {skill.perks?.map(
                    (perk, index) =>
                      `${perk}${index < (skill.perks?.length || 0) - 1 ? ", " : ""}`
                  )}
                </div>
              </div>
            </div>
          ))
        }
      </div>
    </section>

    <!-- Honors & Awards Section -->
    <section class="mb-12">
      <h2
        class="text-[16pt] font-bold mb-2 flex items-center text-gray-200 section-title-line"
      >
        <span class="secondary">Hon</span>ors & Awards
      </h2>
      {
        Object.entries(honors).map(([category, categoryHonors]) => (
          <div class="mt-3">
            <div class="text-[10pt] font-bold mb-2 text-gray-200">
              {category}
            </div>
            {categoryHonors.map((honor) => (
              <div class="flex flex-col lg:grid lg:grid-cols-12 lg:gap-4 mb-3">
                <div class="lg:col-span-2 mb-1 lg:mb-0 lg:text-right">
                  <div class="text-[8pt] text-gray-400 whitespace-nowrap">
                    {honor.year}
                  </div>
                </div>
                <div class="lg:col-span-7 mb-1 lg:mb-0">
                  <span class="text-[8pt] font-bold text-gray-200">
                    {honor.title}
                  </span>
                </div>
                <div class="lg:col-span-3 lg:text-right">
                  <div class="text-[8pt] italic font-light secondary whitespace-nowrap overflow-hidden text-ellipsis">
                    {honor.location}
                  </div>
                </div>
              </div>
            ))}
          </div>
        ))
      }
    </section>
  </div>
</BaseLayout>
