---
import type { TableOfContent } from "@/types";

interface Props {
  headings: TableOfContent[];
}

const { headings } = Astro.props;

const filteredHeadings = headings.filter((heading) => heading.depth <= 3);
---

{
  filteredHeadings.length > 1 && (
    <table-of-contents class="hidden md:block fixed top-1/4 right-2 lg:right-4 xl:right-6 2xl:right-8 z-10 max-w-64 lg:max-w-48 xl:max-w-52 max-h-[60vh] overflow-y-auto">
      <details open>
        <summary class="cursor-pointer text-xs font-medium text-gray-400 hover:text-gray-200 transition-colors duration-200 mb-3 [&::-webkit-details-marker]:hidden list-none [&>span>svg]:data-[open]:rotate-90">
          <span class="flex items-center">
            <svg
              class="w-3 h-3 mr-1.5 transition-transform duration-200"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 6h16M4 12h16M4 18h7"
              />
            </svg>
            Table of Contents
          </span>
        </summary>

        <nav class="bg-gray-100 dark:bg-zinc-800 border border-gray-200 dark:border-zinc-700 rounded-lg p-3 shadow-lg animate-in slide-in-from-top-2 duration-200 scrollbar-thin scrollbar-thumb-gray-300 dark:scrollbar-thumb-zinc-600 scrollbar-track-transparent hover:scrollbar-thumb-gray-400 dark:hover:scrollbar-thumb-zinc-500">
          <ul class="space-y-1 list-none m-0 p-0">
            {filteredHeadings.map((heading) => (
              <li
                class={`${heading.depth > 2 ? "ml-3" : ""} list-none m-0 p-0`}
              >
                <a
                  href={`#${heading.slug}`}
                  class={`
                    block text-gray-600 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 transition-colors duration-200 
                    line-clamp-2 relative break-words rounded px-1.5 py-1 mx-0 my-0.5 no-underline
                    hover:bg-blue-50 dark:hover:bg-blue-950/20
                    data-[active]:text-blue-600 data-[active]:dark:text-blue-400 data-[active]:underline data-[active]:decoration-1 data-[active]:underline-offset-2 data-[active]:font-medium
                    ${heading.depth <= 2 ? "text-xs mt-2" : "text-[10px] mt-1"}
                  `}
                  data-toc-link
                >
                  <span aria-hidden="true" class="mr-1 opacity-60">
                    #
                  </span>
                  {heading.text}
                </a>
              </li>
            ))}
          </ul>
        </nav>
      </details>
    </table-of-contents>
  )
}

<style>
  html {
    scroll-behavior: smooth;
  }

  :target {
    scroll-margin-top: 2rem;
  }

  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>

<script>
  import("@/scripts/table-of-contents");
</script>
