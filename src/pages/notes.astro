---
import BaseLayout from "@layouts/base-layout.astro";
import { siteConfig } from "@site-config";
import type { GroupedNotesByYear, Note } from "@types";
import { getNotesGroupedByYear } from "@utils/note";
import RssIcon from "@icons/rss.svg";

const groupedNotesEntries: GroupedNotesByYear = await getNotesGroupedByYear();
---

<BaseLayout
  title={`Notes Â· ${siteConfig.siteTitle}`}
  description="Discover the historical collection of published notes. Each note is a brief informational update for visitors, such as resume updates, new portfolio projects, or job opportunity announcements."
>
  <section>
    <header>
      <div
        class="flex items-center justify-between mb-6 pb-2 border-b border-gray-200 dark:border-gray-700"
      >
        <h2 class="font-semibold text-2xl">Notes</h2>
        <a
          href="/notes/rss.xml"
          target="_blank"
          rel="noopener noreferrer"
          class="flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400 hover:text-yellow-400 dark:hover:text-yellow-400 transition-colors duration-200"
          title="Subscribe to RSS feed"
          aria-label="Subscribe to RSS feed"
        >
          <RssIcon class="w-5 h-5" />
          <span>RSS</span>
        </a>
      </div>
    </header>
    <div class="notes-list">
      {
        groupedNotesEntries.map(([year, notes]: [string, Note[]]) => (
          <div id={year}>
            <h3 class="font-bold text-xl my-4">{year}</h3>
            {notes.map((note: Note) => (
              <a href={`/notes/${note.slug}`} class="block">
                <article
                  class={`inline-grid rounded-md bg-gray-800 px-4 py-3 group border border-transparent transition-all duration-200 hover:shadow-lg cursor-pointer w-full mb-5`}
                >
                  <h3 class="title text-base">
                    <span class="secondary">{note.title}</span>
                  </h3>
                  <time
                    datetime={note.publishDate}
                    title={note.publishDate}
                    class="text-sm"
                  >
                    {new Date(note.publishDate).toLocaleString(
                      siteConfig.locale,
                      {
                        dateStyle: "short",
                        timeStyle: "short",
                      }
                    )}
                  </time>
                  <div class="mt-4 max-w-none line-clamp-6 text-white">
                    <p>{note.description}</p>
                  </div>
                </article>
              </a>
            ))}
          </div>
        ))
      }
    </div>
  </section>
</BaseLayout>
